---
- hosts:
    - k3s_nodes

  tasks:
  - name: Stop services
    systemd:
      name: "{{ item }}"
      state: stopped
    loop:
      - docker
      - k3s-node

  - name: Delete data
    file:
      path: "{{ item }}"
      state: absent
    loop:
      - /etc/rancher
      - /var/lib/rancher

- hosts:
    - k3s_masters

  tasks:
  - name: Stop services
    systemd:
      name: "{{ item }}"
      state: stopped
    loop:
      - k3s-master
      - kube-apiserver
      - kube-scheduler
      - kube-controller-manager

  - name: Delete data
    file:
      path: "{{ item }}"
      state: absent
    loop:
      - /etc/rancher
      - /var/lib/rancher
      - /etc/kubernetes
      - /var/lib/kubelet

- hosts:
    - etcd

  tasks:
  - name: Stop services
    systemd:
      name: "{{ item }}"
      state: stopped
    loop:
      - etcd

  - name: Delete data
    file:
      path: "{{ item }}"
      state: absent
    loop:
      - /etc/ssl/etcd
      - /etc/etcd
      - /var/lib/etcd

